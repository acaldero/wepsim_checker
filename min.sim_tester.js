function load_firmware_from_files(e,b){var d="";for(var c=0;c<e.length;c++){d=d+show_filerow(e[c],c)}$(b).html(d);var a=new Array();for(var c=0;c<e.length;c++){load_firmware_from_files_aux(e,a,c)}$("#pbar1").attr("aria-valuenow",0);$("#pbar1").attr("aria-valuemin",0);$("#pbar1").attr("aria-valuemax",e.length)}function add_comment(c,a,d){$("#CF"+c).text($("#CF"+c).text()+"("+d+") ");var b=$("#RC"+c).text();if(b=='"NONE"'){$("#RC"+c).text('"'+a+'" ')}else{$("#RC"+c).text(b+'"'+a+'" ')}b=$("#RC"+c).text().replace('" "',", ");$("#RC"+c).text(b)}function execute_asm_and_firmware(c){init("","","","");reset();var f=sim_states.REG_PC.value;var e=sim_states.REG_PC.value-4;var h=0;if((typeof segments[".text"]!="undefined")&&(typeof segments[".text"].begin!="undefined")){h=parseInt(segments[".text"].begin)}var d=0;if((typeof segments[".text"]!="undefined")&&(typeof segments[".text"].end!="undefined")){d=parseInt(segments[".text"].end)}var b=0;if((typeof segments[".ktext"]!="undefined")&&(typeof segments[".ktext"].begin!="undefined")){b=parseInt(segments[".ktext"].begin)}var g=0;if((typeof segments[".ktext"]!="undefined")&&(typeof segments[".ktext"].end!="undefined")){g=parseInt(segments[".ktext"].end)}var a=true;while((a)&&(f!=e)&&(((f<d)&&(f>=h))||((f<g)&&(f>=b)))){a=execute_microprogram(c);e=f;f=sim_states.REG_PC.value}return a}function execute_firmwares_and_asm_i(l,f,n,d){var c=parseInt($("#pbar1").attr("aria-valuemax"));var k=Math.trunc(100*d/c);$("#pbar1").attr("aria-valuenow",d);$("#pbar1").html(k+"%");$("#pbar1").css("width",k+"%");if(d>=c){return}var b=$("#LF"+d);if(b.length==0){return}var m=b.text();var a=loadFirmware(m);$("#BF"+d).text(JSON.stringify(a));if(a.error!=null){$("#RUC"+d).text("1");add_comment(d,"firmware error:"+a.error.split("(*)")[1],a.error);setTimeout(function(){execute_firmwares_and_asm_i(l,f,n,d+1)},120);return}$("#RUC"+d).text("0");update_memories(a);var e=simlang_compile(n,l);$("#EF"+d).text(JSON.stringify(e,null,2));$("#RE"+d).text("0");if(e.error!=null){$("#RE"+d).text("1");add_comment(d,"assembly error:"+e.error.split("(*)")[1],e.error);setTimeout(function(){execute_firmwares_and_asm_i(l,f,n,d+1)},120);return}set_simware(e);update_memories(l);var j=execute_asm_and_firmware(2048);var h=wepsim_to_check(f);if(h.errors!=0){add_comment(d,"execution error:"+wepsim_checkreport2txt(h.result),JSON.stringify(h.result,null,2))}if(j==false){var g="more than 2048 clock cycles in one single instruction.";add_comment(d,"execution error: "+g+"<br>",g);$("#XF"+d).text("<pre>ERROR: "+g+"</pre><br>"+JSON.stringify(h.result,null,2));$("#RX"+d).text(h.errors+1)}else{$("#XF"+d).text(JSON.stringify(h.result,null,2));$("#RX"+d).text(h.errors)}setTimeout(function(){execute_firmwares_and_asm_i(l,f,n,d+1)},120)}function execute_firmwares_and_asm(d,c){var a=get_simware();var b=wepsim_read_checklist(d);execute_firmwares_and_asm_i(a,b,c,0)}function load_firmware_from_files_aux(c,a,b){a[b]=new FileReader();a[b].onload=function(d){var e=d.target.result;$("#LF"+b).text(e);$("#RL"+b).text("0")};a[b].readAsText(c[b],"UTF-8")}function show_filerow(c,a){var b="";b=b+"<tr><td>"+c.name+"</td><td>    <div id='LF"+a+"' style='display:none; max-height:80vh; max-width:80vw;'></div>    <a href='#'        onclick=\"show_firm_origin("+a+");\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RL"+a+"'>NONE</div></a></td><td>    <div id='BF"+a+"' style='display:none; max-height:80vh; max-width:80vw;'></div>    <a href='#'        onclick=\"show_firm_result("+a+");\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RUC"+a+"'>NONE</div></a></td><td>    <div id='EF"+a+"' style='display:none; max-height:80vh; max-width:80vw;'></div>    <a href='#'        onclick=\"show_asm_result("+a+");\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RE"+a+"'>NONE</div></a></td><td>    <div id='XF"+a+"' style='display:none; max-height:80vh; max-width:80vw;'></div>    <a href='#'        onclick=\"show_checklist_result("+a+");\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RX"+a+"'>NONE</div></a></td><td>    <div id='CF"+a+"' style='display:none;font-size:small; max-height:80vh; max-width:80vw;'></div>    <a href='#'        onclick=\"show_comments_result("+a+");\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RC"+a+'\'>"NONE"</div></a></td></tr>';return b}function show_firm_origin(a){var c=$("#LF"+a).text();if(c==""){return show_popup1_content("<br><pre>ERROR: Empty firmware.</pre><br>")}var b='<div style="overflow:auto; height:75vh; width:75vw;"><pre>'+c+"</pre><div>";show_popup1_content(b)}function show_firm_result(a){var d=$("#BF"+a).text();if(d==""){return show_popup1_content("<h1>Please &#181;check and wait for results.</h1>")}var c=JSON.parse(d);if(c.error!=null){return show_popup1_content("<br><pre>"+c.error+"</pre><br>")}var b=firmware2html(c.firmware,false);show_popup1_content(b)}function show_asm_result(a){var c=$("#EF"+a).text();if(c==""){return show_popup1_content("<h1>Please &#181;check and wait for results.</h1>")}var b=JSON.parse(c);if(b.error!=null){return show_popup1_content("<br><pre>"+b.error+"</pre><br>")}var d="<div class='row'><div class='col-xs-3 col-sm-3'><center><h3>Memory map</h3></center><div id='cc_map' style='overflow-y:scroll; overflow-x:auto;'>   <div id='compile_mm'>"+segments2html(b.seg)+"</div></div></div><div class='col-xs-9 col-sm-9'><center><h3>Main memory</h3></center><div id='cc_bin' style='overflow-y:scroll; overflow-x:auto; max-height:80vh;'>   <div id='compile_mp'>"+mp2html(b.mp,b.labels2,b.seg)+"</div></div></div></div>";show_popup1_content(d);for(skey in b.seg){$("#compile_begin_"+skey).html("0x"+b.seg[skey].begin.toString(16));$("#compile_end_"+skey).html("0x"+b.seg[skey].end.toString(16))}$("#popup1div").enhanceWithin()}function show_checklist_result(b){var d=$("#XF"+b).text();if(d==""){return show_popup1_content("<h1>Please &#181;check and wait for results.</h1>")}var a=JSON.parse(d);if(a.error!=null){return show_popup1_content("<br><pre>"+a.error+"</pre><br>")}var c=wepsim_checkreport2html(a,false);show_popup1_content(c)}function show_comments_result(a){var b=$("#CF"+a).text();if((b=="")||(b==null)){return show_popup1_content("<h1>Please &#181;check and wait for results.</h1>")}show_popup1_content(b)}function show_popup1_content(a){$("#popup1").popup("open");$("#popup1div").html(a);$("#popup1div").enhanceWithin()};