function checkreport2html(c){var d="";var a="green";d+="<table border=1><tr><th>Element Type</th><th>Element Id.</th><th>Expected</th><th>Obtained</th></tr>";for(var b=0;b<c.length;b++){if(c[b].equals===false){a="orange"}else{a="lightgreen"}d+="<tr bgcolor="+a+"><td>"+c[b].elto_type+"</td><td>"+c[b].elto_id+"</td><td>"+c[b].expected+"</td><td>"+c[b].obtained+"</td></tr>"}d+="</table>";return d}function checkreport2txt(b){var c="";for(var a=0;a<b.length;a++){if(b[a].equals===false){c+=b[a].elto_type+"["+b[a].elto_id+"] = "+b[a].obtained+" (expected "+b[a].expected+") "}}return c}function read_checklist(c){var d=new Object();d.registers=new Object();d.memory=new Object();d.screen=new Object();var a=c.split("\n");for(var b=0;b<a.length;b++){check=a[b].trim().split(" ");if(check==""){continue}if(check.length<3){console.log("ERROR in checklist at line "+b+": "+a[b]);continue}if(check[0].toUpperCase().trim()=="REGISTER"){d.registers[check[1]]=check[2]}if(check[0].toUpperCase().trim()=="MEMORY"){d.memory[check[1]]=check[2]}if(check[0].toUpperCase().trim()=="SCREEN"){d.screen[check[1]]=check[2]}}return d}function to_check(e){var m=new Array();var i=0;if(typeof e.registers!="undefined"){for(var b in e.registers){var f=parseInt(b);var j=new Object();j.expected=e.registers[f];j.obtained=get_value(sim_states.BR[f]);j.equals=(e.registers[f]==get_value(sim_states.BR[f]));j.elto_type="register";j.elto_id=b;m.push(j);if(j.equals===false){i++}}}if(typeof e.memory!="undefined"){for(var c in e.memory){var f=parseInt(c);if(typeof MP[f]=="undefined"){var k=0}else{var k=MP[f]}var j=new Object();j.expected=e.memory[f];j.obtained=k;j.equals=(e.memory[f]==k);j.elto_type="memory";j.elto_id=c;m.push(j);if(j.equals===false){i++}}}if(typeof e.screen!="undefined"){var h=get_screen_content();var a=h.trim().split("\n");for(var l in e.screen){var f=parseInt(l);if(typeof a[f]=="undefined"){var k=""}else{var k=a[f]}var j=new Object();j.expected=e.screen[f];j.obtained=k;j.equals=(e.screen[f]==k);j.elto_type="screen";j.elto_id=l;m.push(j);if(j.equals===false){i++}}}var g=new Object();g.result=m;g.errors=i;return g}function load_firmware_from_files(e,b){var d="";for(var c=0;c<e.length;c++){d=d+show_filerow(e[c],c)}$(b).html(d);var a=new Array();for(var c=0;c<e.length;c++){load_firmware_from_files_aux(e,a,c)}$("#pbar1").attr("aria-valuenow",0);$("#pbar1").attr("aria-valuemin",0);$("#pbar1").attr("aria-valuemax",e.length)}function add_comment(c,a,d){$("#CF"+c).text($("#CF"+c).text()+"("+d+") ");var b=$("#RC"+c).text();if(b=='"NONE"'){$("#RC"+c).text('"'+a+'" ')}else{$("#RC"+c).text(b+'"'+a+'" ')}b=$("#RC"+c).text().replace('" "',", ");$("#RC"+c).text(b)}function execute_firmwares_and_asm_i(f,l,a,o){var g=parseInt($("#pbar1").attr("aria-valuemax"));var b=Math.trunc(100*o/g);$("#pbar1").attr("aria-valuenow",o);$("#pbar1").html(b+"%");$("#pbar1").css("width",b+"%");if(o>=g){return}var h=$("#LF"+o);if(h.length==0){return}var j=h.text();var k=loadFirmware(j);$("#BF"+o).text(JSON.stringify(k));if(k.error!=null){$("#RUC"+o).text("1");add_comment(o,"firmware error:"+k.error.split("(*)")[1],k.error);setTimeout(function(){execute_firmwares_and_asm_i(f,l,a,o+1)},220);return}$("#RUC"+o).text("0");update_memories(k);var t=simlang_compile(a,f);$("#EF"+o).text(JSON.stringify(t,null,2));$("#RE"+o).text("0");if(t.error!=null){$("#RE"+o).text("1");add_comment(o,"assembly error:"+t.error.split("(*)")[1],t.error);setTimeout(function(){execute_firmwares_and_asm_i(f,l,a,o+1)},220);return}set_simware(t);update_memories(f);init("","","","");reset();var c=sim_states.REG_PC.value;var s=sim_states.REG_PC.value-4;var e=0;if((typeof segments[".text"]!="undefined")&&(typeof segments[".text"].begin!="undefined")){e=parseInt(segments[".text"].begin)}var n=0;if((typeof segments[".text"]!="undefined")&&(typeof segments[".text"].end!="undefined")){n=parseInt(segments[".text"].end)}var p=0;if((typeof segments[".ktext"]!="undefined")&&(typeof segments[".ktext"].begin!="undefined")){p=parseInt(segments[".ktext"].begin)}var m=0;if((typeof segments[".ktext"]!="undefined")&&(typeof segments[".ktext"].end!="undefined")){m=parseInt(segments[".ktext"].end)}var r=true;while((r)&&(c!=s)&&(((c<n)&&(c>=e))||((c<m)&&(c>=p)))){r=execute_microprogram(2048);s=c;c=sim_states.REG_PC.value}var d=to_check(l);if(d.errors!=0){add_comment(o,"execution error:"+checkreport2txt(d.result),JSON.stringify(d.result,null,2))}if(r==false){var q="more than 2048 clock cycles in one single instruction.";add_comment(o,"execution error: "+q+"<br>",q);$("#XF"+o).text("<pre>ERROR: "+q+"</pre><br>"+JSON.stringify(d.result,null,2));$("#RX"+o).text(d.errors+1)}else{$("#XF"+o).text(JSON.stringify(d.result,null,2));$("#RX"+o).text(d.errors)}setTimeout(function(){execute_firmwares_and_asm_i(f,l,a,o+1)},220)}function execute_firmwares_and_asm(d,c){var a=get_simware();var b=read_checklist(d);execute_firmwares_and_asm_i(a,b,c,0)}function load_firmware_from_files_aux(c,a,b){a[b]=new FileReader();a[b].onload=function(d){var e=d.target.result;$("#LF"+b).text(e);$("#RL"+b).text("0")};a[b].readAsText(c[b],"UTF-8")}function show_filerow(c,a){var b="";b=b+"<tr><td>"+c.name+"</td><td>    <div id='LF"+a+"' style='display:none;'></div>    <a href='#'        onclick=\"$('#IF').popup('open');                 var firm=$('#LF"+a+"').text();                 $('#LF').html('<div style=\\'overflow:auto\\'><pre>'+firm+'</pre><div>');                 $('#LF').enhanceWithin();\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RL"+a+"'>NONE</div></a></td><td>    <div id='BF"+a+"' style='display:none;'></div>    <a href='#'        onclick=\"$('#IUC').popup('open');                 $('#BF').html('<h1>Please &#181;check and wait...</h1>');                 var firm_json=$('#BF"+a+"').text();                 if (firm_json == '') return;                 var firm = JSON.parse(firm_json);                 show_firm_result('#BF', firm);                 $('#BF').enhanceWithin();\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RUC"+a+"'>NONE</div></a></td><td>    <div id='EF"+a+"' style='display:none;'></div>    <a href='#'        onclick=\"$('#IE').popup('open');                 $('#EF').html('<h1>Please &#181;check and wait...</h1>');                 var asm_json=$('#EF"+a+"').text();                 if (asm_json == '') return;                 var asm = JSON.parse(asm_json);                 show_asm_result('#EF', asm);                 $('#EF').enhanceWithin();\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RE"+a+"'>NONE</div></a></td><td>    <div id='XF"+a+"' style='display:none;'></div>    <a href='#'        onclick=\"$('#IX').popup('open');                 $('#XF').html('<h1>Please &#181;check and wait...</h1>');                 var chcklst_json=$('#XF"+a+"').text();                 if (chcklst_json == '') return;                 var chcklst = JSON.parse(chcklst_json);                 show_checklist_result('#XF', chcklst);                 $('#XF').enhanceWithin();\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RX"+a+"'>NONE</div></a></td><td>    <div id='CF"+a+"' style='display:none;font-size:small;'></div>    <a href='#'        onclick=\"$('#IC').popup('open');                 $('#CF').html('<h1>NO COMMENTS</h1>');                 var comments=$('#CF"+a+"').text();                 if (comments== '') return;                 show_comments_result('#CF', comments);                 $('#CF').enhanceWithin();\"       data-position-to='windows' data-transition='none'        data-rel='popup'><div id='RC"+a+'\'>"NONE"</div></a></td></tr>';return b}function show_firm_result(a,b){if(b.error!=null){$(a).html("<br><pre>"+b.error+"</pre><br>");return}$(a).html(firmware2html(b.firmware,false))}function show_asm_result(b,a){if(a.error!=null){$(b).html("<br><pre>"+a.error+"</pre><br>");return}var c="";c=c+"<div class='row'><div class='col-xs-3 col-sm-3'><center><h3>Memory map</h3></center><div id='cc_map' style='overflow-y:scroll; overflow-x:auto; height:70% !important;'>   <div id='compile_mm'></div></div></div><div class='col-xs-9 col-sm-9'><center><h3>Main memory</h3></center><div id='cc_bin' style='overflow-y:scroll; overflow-x:auto; height:70% !important;'>   <div id='compile_mp'>      <center>Please select 'Compile' secondly to have the associated binary code.</center>   </div></div></div></div>";$(b).html(c);$("#compile_mp").html(mp2html(a.mp,a.labels2,a.seg));$("#compile_mm").html(segments2html(a.seg));for(skey in a.seg){$("#compile_begin_"+skey).html("0x"+a.seg[skey].begin.toString(16));$("#compile_end_"+skey).html("0x"+a.seg[skey].end.toString(16))}}function show_checklist_result(b,a){if(a.error!=null){$(b).html("<br><pre>"+a.error+"</pre><br>");return}$(b).html(checkreport2html(a))}function show_comments_result(a,b){if(b==null){$(a).html("<pre>Empty</pre>");return}$(a).html(b)};